#!/bin/bash
# auto_karlancer.sh
# ุฑุจุงุช ฺฉุงููุงู ุฎูุฏฺฉุงุฑ ฺฉุงุฑููุณุฑ - ููุท ฺฉ ุจุงุฑ ุงุฌุฑุง ฺฉูุฏ ู ุจุฑุฏ!
#
# โ๏ธ ูุดุฏุงุฑ: ุงู ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ proposal ูุง ุฑุง ุงุฑุณุงู ูโฺฉูุฏ
# ุจุฏูู ูุงุฒ ุจู ุชุงุฏ. ูุณุฆููุช ุงุณุชูุงุฏู ุจุง ุดูุงุณุช.

# ุชูุธูุงุช encoding
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
export PYTHONIOENCODING=utf-8

# ุฑูฺฏโูุง
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m'

echo -e "${RED}โ๏ธ  โ๏ธ  โ๏ธ  ูุดุฏุงุฑ โ๏ธ  โ๏ธ  โ๏ธ${NC}"
echo "================================================================================"
echo -e "${YELLOW}ุงู ุฑุจุงุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ู ุจุฏูู ุชุงุฏ:${NC}"
echo "  1. ูพุฑูฺูโูุง ุฌุฏุฏ ุฑุง ูพุฏุง ูโฺฉูุฏ"
echo "  2. ุจุง Claude ุชุญูู ูโฺฉูุฏ"
echo -e "${RED}  3. ุฎูุฏฺฉุงุฑ proposal ุฑุง ุงุฑุณุงู ูโฺฉูุฏ (ุจุฏูู ุชุงุฏ!)${NC}"
echo "  4. ุงู ฺฉุงุฑ ุฑุง ุชุง ุงุจุฏ ุงุฏุงูู ูโุฏูุฏ"
echo ""
echo -e "${YELLOW}ูุณุฆููุช ุงุณุชูุงุฏู ฺฉุงููุงู ุจุง ุดูุงุณุช!${NC}"
echo "================================================================================"
echo ""

# ูพุงุฑุงูุชุฑูุง
INTERVAL=${1:-300}  # ูพุดโูุฑุถ 5 ุฏููู
MODE=${2:-continuous}

# ููุงุด ุชูุธูุงุช
echo -e "${CYAN}โ๏ธ  ุชูุธูุงุช:${NC}"
echo "  - ูุงุตูู ุจุฑุฑุณ: $INTERVAL ุซุงูู ($((INTERVAL / 60)) ุฏููู)"
echo "  - ุญุงูุช: $MODE"
echo -e "${RED}  - ุงุฑุณุงู ุฎูุฏฺฉุงุฑ: ูุนุงู โ${NC}"
echo ""

# ุชุงุฏ ููุง
read -p "ุขุง ูุทูุฆู ูุณุชุฏุ (yes/NO): " CONFIRM

if [ "$CONFIRM" != "yes" ]; then
    echo -e "${YELLOW}โ ูุบู ุดุฏ. ุจุฑุง ุงุฌุฑุง ุจุงุฏ ุฏููุงู 'yes' ุชุงูพ ฺฉูุฏ${NC}"
    exit 1
fi

echo ""
echo -e "${GREEN}โ ุดุฑูุน ุฑุจุงุช ุฎูุฏฺฉุงุฑ...${NC}"
echo ""

# ุจุฑุฑุณ Python
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}โ Python3 ุงูุช ูุดุฏ${NC}"
    exit 1
fi

# ุจุฑุฑุณ Claude CLI
if ! command -v claude &> /dev/null; then
    echo -e "${RED}โ Claude CLI ุงูุช ูุดุฏ${NC}"
    exit 1
fi

# ุจุฑุฑุณ ูุงู prompt
if [ ! -f "karelancer_prompt.txt" ]; then
    echo -e "${RED}โ karelancer_prompt.txt ุงูุช ูุดุฏ${NC}"
    exit 1
fi

echo -e "${GREEN}โ ููู ฺุฒ ุขูุงุฏู ุงุณุช${NC}"
echo "================================================================================"
echo ""

# ุงุฌุฑุง
if [ "$MODE" = "once" ]; then
    echo -e "${YELLOW}๐ ุงุฌุฑุง ฺฉโุจุงุฑู ุจุง ุงุฑุณุงู ุฎูุฏฺฉุงุฑ...${NC}"
    python3 continuous_karlancer.py --interval "$INTERVAL" --auto-submit --once
else
    echo -e "${RED}๐ ุดุฑูุน ุญุงูุช ูุฏุงูู ุจุง ุงุฑุณุงู ุฎูุฏฺฉุงุฑ...${NC}"
    echo -e "${CYAN}๐ก ุจุฑุง ุชููู: Ctrl+C${NC}"
    echo -e "${RED}โ๏ธ  ุชูุฌู: proposal ูุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุฑุณุงู ูโุดููุฏ!${NC}"
    echo ""
    python3 continuous_karlancer.py --interval "$INTERVAL" --auto-submit
fi
